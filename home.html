<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BioLens - Food Safety Monitoring System</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="firebase/config.js"></script>
    <script src="js/auth.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* CSS Reset */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
      }

      /* --- Color Palette --- */
      :root {
        --primary-50: #eff6ff;
        --primary-100: #dbeafe;
        --primary-500: #3b82f6;
        --primary-600: #2563eb;
        --primary-700: #1d4ed8;
        --secondary-500: #10b981;
        --secondary-600: #059669;
        --green-50: #f0fdf4;
        --green-100: #dcfce7;
        --green-600: #16a34a;
        --green-700: #15803d;
        --amber-50: #fffbeb;
        --amber-100: #fef3c7;
        --amber-600: #d97706;
        --amber-700: #b45309;
        --red-50: #fef2f2;
        --red-100: #fee2e2;
        --red-500: #ef4444;
        --red-600: #dc2626;
        --red-700: #b91c1c;
        --slate-50: #f8fafc;
        --slate-100: #f1f5f9;
        --slate-200: #e2e8f0;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
      }

      /* --- Body & Container --- */
      html {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-y: auto;
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }
      
      /* Hide scrollbar for Chrome, Safari and Opera */
      body::-webkit-scrollbar {
        display: none;
        width: 0;
        height: 0;
      }
      
      body {
        min-height: 100vh;
        background-color: var(--slate-50);
        background-image: radial-gradient(
            circle at 1px 1px,
            var(--slate-200) 1px,
            transparent 0
          ),
          radial-gradient(
            circle at 25px 25px,
            var(--slate-200) 1px,
            transparent 0
          );
        background-size: 50px 50px;
        color: var(--gray-800);
      }

      .container {
        max-width: 28rem;
        margin: 0 auto;
        padding: 1rem;
        padding-bottom: 6rem; /* Space for bottom nav */
      }

      /* --- Card Base Style --- */
      .card {
        background: white;
        border-radius: 1.25rem;
        padding: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05),
          0 2px 4px -2px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--slate-100);
        margin-bottom: 1rem;
      }

      /* --- Header --- */
      .header {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border-radius: 1.25rem;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid var(--primary-100);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05),
          0 2px 4px -2px rgba(0, 0, 0, 0.05);
      }

      .header-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.75rem;
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo {
        background: transparent;
        padding: 0.5rem;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: none;
        width: 2.5rem;
        height: 2.5rem;
      }
      .logo i {
        color: white;
        font-size: 1.25rem;
      }
      
      .logo-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 0.5rem;
      }

      .app-info h1 {
        font-size: 1.25rem; /* DIUBAH */
        font-weight: 700;
        color: var(--gray-900);
      }
      .app-info p {
        font-size: 0.8rem;
        color: var(--gray-600);
      } /* DIUBAH */

      .notification-btn {
        position: relative;
        padding: 0.5rem;
        border: none;
        background: transparent;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s;
      }
      .notification-btn:hover {
        background: var(--slate-100);
      }
      .notification-btn i {
        font-size: 1.125rem;
        color: var(--gray-600);
      }

      .notification-badge {
        position: absolute;
        top: 0;
        right: 0;
        width: 1.25rem;
        height: 1.25rem;
        background: var(--red-500);
        color: white;
        font-size: 0.625rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        border: 2px solid white;
      }

      .date-time {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem; /* DIUBAH */
        background: var(--primary-50);
        border-radius: 0.75rem;
        padding: 0.5rem 0.75rem;
      }
      .date-time i {
        font-size: 0.875rem;
        color: var(--primary-600);
      }
      .date-time span {
        font-weight: 600;
        color: var(--gray-700);
      }
      .date-time .separator {
        color: var(--gray-400);
      }

      /* --- Stats Grid --- */
      .stats-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      /* Main Stats Card */
      .stats-card {
        background: linear-gradient(
          135deg,
          var(--primary-700),
          var(--primary-500)
        );
        border-radius: 1.25rem;
        box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.4);
        padding: 1rem;
        color: white;
      }

      .stats-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
      }
      .stats-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        font-weight: 700;
      } /* DIUBAH */
      .stats-title i {
        font-size: 1rem;
      }

      .realtime-badge {
        font-size: 0.625rem;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.25rem 0.625rem;
        border-radius: 9999px;
        font-weight: 600;
      }

      .stats-items {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.75rem;
      }

      .stat-item {
        text-align: center;
      }
      .stat-icon {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
      }
      .stat-value {
        font-size: 1.6rem;
        font-weight: 700;
        line-height: 1;
      } /* DIUBAH */
      .stat-label {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
      } /* DIUBAH */

      /* Breakdown Status Card */
      .card-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem; /* DIUBAH */
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.75rem;
      }
      .card-header i {
        font-size: 1rem;
        color: var(--primary-600);
      }

      .breakdown-items {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.75rem;
      }

      .breakdown-item {
        text-align: center;
        padding: 0.75rem 0.5rem;
        border-radius: 1rem;
        border: 1px solid;
      }
      .breakdown-item.safe {
        background: var(--green-50);
        border-color: var(--green-100);
      }
      .breakdown-item.warning {
        background: var(--amber-50);
        border-color: var(--amber-100);
      }
      .breakdown-item.danger {
        background: var(--red-50);
        border-color: var(--red-100);
      }

      .breakdown-item i {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
      }
      .breakdown-item.safe i {
        color: var(--green-600);
      }
      .breakdown-item.warning i {
        color: var(--amber-600);
      }
      .breakdown-item.danger i {
        color: var(--red-600);
      }

      .breakdown-value {
        font-size: 1.3rem;
        font-weight: 700;
        line-height: 1;
        margin-bottom: 0.25rem;
      } /* DIUBAH */
      .breakdown-item.safe .breakdown-value {
        color: var(--green-600);
      }
      .breakdown-item.warning .breakdown-value {
        color: var(--amber-600);
      }
      .breakdown-item.danger .breakdown-value {
        color: var(--red-600);
      }

      .breakdown-label {
        font-size: 0.7rem;
        font-weight: 600;
        line-height: 1.25;
      } /* DIUBAH */
      .breakdown-item.safe .breakdown-label {
        color: var(--green-700);
      }
      .breakdown-item.warning .breakdown-label {
        color: var(--amber-700);
      }
      .breakdown-item.danger .breakdown-label {
        color: var(--red-700);
      }

      .breakdown-percentage {
        font-size: 0.5rem;
        margin-top: 0.25rem;
      }
      .breakdown-item.safe .breakdown-percentage {
        color: rgba(22, 163, 74, 0.8);
      }
      .breakdown-item.warning .breakdown-percentage {
        color: rgba(217, 119, 6, 0.8);
      }
      .breakdown-item.danger .breakdown-percentage {
        color: rgba(220, 38, 38, 0.8);
      }

      /* Trend & Alert Section */
      .trend-alert-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .trend-title {
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.75rem;
      } /* DIUBAH */
      .trend-chart {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        height: 5rem;
        gap: 0.25rem;
      }
      .trend-bar-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
      }
      .trend-value {
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--primary-600);
      } /* DIUBAH */
      .trend-bar {
        width: 100%;
        background: linear-gradient(
          to top,
          var(--primary-500),
          var(--primary-100)
        );
        border-radius: 0.25rem;
        transition: all 0.3s;
      }
      .trend-bar:hover {
        filter: brightness(1.1);
      }
      .trend-day {
        font-size: 0.7rem;
        color: var(--gray-600);
        font-weight: 500;
      } /* DIUBAH */

      .alert-mini-card {
        background: linear-gradient(135deg, var(--red-600), var(--red-500));
        color: white;
        border-radius: 1.25rem;
      }
      .alert-mini-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .alert-mini-header i {
        font-size: 1rem;
      }
      .alert-mini-title {
        font-size: 0.9rem;
        font-weight: 700;
      } /* DIUBAH */
      .alert-mini-content {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        align-items: flex-start;
      }
      .alert-mini-text {
        font-size: 0.9rem;
        font-weight: 600;
      } /* DIUBAH */
      .alert-mini-subtext {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.9);
      } /* DIUBAH */
      .alert-mini-btn {
        width: auto;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 0.625rem;
        font-weight: 700;
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        margin-top: 0.5rem;
        transition: all 0.2s;
        cursor: pointer;
      }
      .alert-mini-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Recent Samples */
      .samples-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.75rem;
      }
      .samples-title {
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--gray-900);
      } /* DIUBAH */
      .view-all-btn {
        color: var(--primary-600);
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        background: none;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      } /* DIUBAH */
      .view-all-btn:hover {
        color: var(--primary-700);
      }
      .view-all-btn i {
        font-size: 0.875rem;
        transition: transform 0.2s;
      }
      .view-all-btn:hover i {
        transform: translateX(0.125rem);
      }

      .samples-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      .sample-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem;
        border-radius: 1rem;
        transition: all 0.2s;
      }
      .sample-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      }
      .sample-item.safe {
        background: var(--green-50);
      }
      .sample-item.warning {
        background: var(--amber-50);
      }
      .sample-item.danger {
        background: var(--red-50);
      }

      .sample-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
        min-width: 0;
      }
      .sample-icon {
        flex-shrink: 0;
        font-size: 1.25rem;
      }
      .sample-item.safe .sample-icon {
        color: var(--green-600);
      }
      .sample-item.warning .sample-icon {
        color: var(--amber-600);
      }
      .sample-item.danger .sample-icon {
        color: var(--red-600);
      }

      .sample-details {
        flex: 1;
        min-width: 0;
      }
      .sample-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray-900);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      } /* DIUBAH */
      .sample-cfu {
        font-size: 0.8rem;
        color: var(--gray-600);
      } /* DIUBAH */

      .sample-meta {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-left: 0.5rem;
      }
      .sample-time {
        font-size: 0.8rem;
        color: var(--gray-500);
      } /* DIUBAH */
      .sample-status {
        padding: 0.25rem 0.625rem;
        border-radius: 9999px;
        font-size: 0.7rem;
        font-weight: 700;
      } /* DIUBAH */
      .sample-item.safe .sample-status {
        background: var(--green-100);
        color: var(--green-700);
      }
      .sample-item.warning .sample-status {
        background: var(--amber-100);
        color: var(--amber-700);
      }
      .sample-item.danger .sample-status {
        background: var(--red-100);
        color: var(--red-700);
      }

      /* Active Warning Card */
      .warning-card.card {
        border: 2px solid var(--red-300);
      }
      .warning-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .warning-icon {
        background: var(--red-100);
        padding: 0.5rem;
        border-radius: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .warning-icon i {
        font-size: 1rem;
        color: var(--red-600);
      }
      .warning-title {
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--red-700);
      } /* DIUBAH */

      .warning-content {
        background: var(--red-50);
        border-radius: 1rem;
        padding: 0.75rem;
      }
      .warning-top {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }
      .warning-details {
        flex: 1;
      }
      .warning-item {
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--red-800);
      } /* DIUBAH */
      .warning-desc {
        font-size: 0.8rem;
        color: var(--red-700);
        margin-top: 0.125rem;
      } /* DIUBAH */
      .warning-badge {
        background: var(--red-600);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.625rem;
        font-weight: 700;
      }
      .warning-bottom {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .warning-time {
        font-size: 0.8rem;
        color: var(--red-600);
        display: flex;
        align-items: center;
        gap: 0.25rem;
      } /* DIUBAH */
      .warning-time i {
        font-size: 0.875rem;
      }

      .warning-actions {
        display: flex;
        gap: 0.5rem;
      }
      .warning-btn {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      } /* DIUBAH */
      .warning-btn.detail {
        background: white;
        border: 1px solid var(--red-300);
        color: var(--red-600);
      }
      .warning-btn.detail:hover {
        background: var(--red-50);
      }
      .warning-btn.process {
        background: var(--red-600);
        color: white;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }
      .warning-btn.process:hover {
        background: var(--red-700);
      }
      .warning-btn.process i {
        font-size: 0.75rem;
      }

      /* --- Bottom Navigation --- */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--slate-200);
        z-index: 50;
        padding-bottom: env(safe-area-inset-bottom);
      }

      .nav-container {
        max-width: 28rem;
        margin: 0 auto;
        display: flex;
        justify-content: space-around;
        padding: 0.5rem;
      }

      .nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        padding: 0.5rem 0;
        border: none;
        text-decoration: none;
        background: transparent;
        cursor: pointer;
        position: relative;
        transition: color 0.2s ease-in-out;
        color: var(--gray-400);
      }
      .nav-btn:hover {
        color: var(--primary-500);
      }
      .nav-btn.active {
        color: var(--primary-600);
      }

      .nav-btn i {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
      }
      .nav-label {
        font-size: 0.7rem;
        font-weight: 500;
      } /* DIUBAH */
      .nav-btn.active .nav-label {
        font-weight: 700;
      }

      .nav-btn .nav-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 3.5rem;
        height: 2rem;
        background-color: var(--primary-100);
        border-radius: 9999px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
      }

      .nav-btn.active .nav-indicator {
        opacity: 1;
      }

      /* Floating Chat Bubble */
      .chat-bubble {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background-color: #00897b;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
        border: none;
        outline: none;
      }

      .chat-bubble:hover {
        transform: scale(1.1);
        background-color: #00695c;
      }

      .chat-bubble i {
        color: white;
        font-size: 24px;
      }

      .chat-bubble .pulse {
        position: absolute;
        width: 100%;
        height: 100%;
        background: #00897b;
        border-radius: 50%;
        animation: pulse 2s infinite;
        z-index: -1;
        opacity: 0.5;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 0.5;
        }
        70% {
          transform: scale(1.5);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="header-top">
          <div class="logo-container">
            <div class="logo">
              <img src="assets/logo2.png" alt="BioLens Logo" class="logo-img">
            </div>
            <div class="app-info">
              <h1>Bio-Lens</h1>
              <p>Food Safety Monitoring</p>
            </div>
          </div>
          <button class="notification-btn">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
          </button>
        </div>
        <div class="date-time">
          <i class="fas fa-calendar"></i>
          <span id="currentDate">Loading...</span>
          <span class="separator">•</span>
          <i class="fas fa-clock"></i>
          <span id="currentTime">Loading...</span>
        </div>
      </header>

      <div class="stats-grid">
        <div class="stats-card">
          <div class="stats-header">
            <div class="stats-title">
              <i class="fas fa-chart-line"></i>
              <span>Status Hari Ini</span>
            </div>
            <div class="realtime-badge">Real-time</div>
          </div>
          <div class="stats-items">
            <div class="stat-item">
              <div class="stat-icon">📊</div>
              <div class="stat-value" id="totalScanValue">0</div>
              <div class="stat-label">Total Scan</div>
            </div>
            <div class="stat-item">
              <div class="stat-icon">⚠️</div>
              <div class="stat-value" id="contaminationValue">0</div>
              <div class="stat-label">Kontaminasi</div>
            </div>
            <div class="stat-item">
              <div class="stat-icon">✅</div>
              <div class="stat-value" id="sterilValue">0</div>
              <div class="stat-label">Steril</div>
            </div>
            <div class="stat-item">
              <div class="stat-icon">📈</div>
              <div class="stat-value" id="successRateValue">0%</div>
              <div class="stat-label">Success Rate</div>
            </div>
          </div>
        </div>
      </div>

      <div class="breakdown-card card">
        <div class="card-header">
          <i class="fas fa-chart-pie"></i>
          <span>Status Breakdown</span>
        </div>
        <div class="breakdown-items">
          <div class="breakdown-item safe">
            <i class="fas fa-check-circle"></i>
            <div class="breakdown-value" id="safeValue">0</div>
            <div class="breakdown-label">AMAN</div>
            <div class="breakdown-percentage" id="safePercentage">0%</div>
          </div>
          <div class="breakdown-item warning">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="breakdown-value" id="warningValue">0</div>
            <div class="breakdown-label">WARNING</div>
            <div class="breakdown-percentage" id="warningPercentage">0%</div>
          </div>
          <div class="breakdown-item danger">
            <i class="fas fa-times-circle"></i>
            <div class="breakdown-value" id="dangerValue">0</div>
            <div class="breakdown-label">BAHAYA</div>
            <div class="breakdown-percentage" id="dangerPercentage">0%</div>
          </div>
        </div>
      </div>

      <div class="trend-alert-grid">
        <div class="trend-card card">
          <div class="trend-title">7-Day Trend</div>
          <div class="trend-chart"></div>
        </div>
        <div class="alert-mini-card card" id="alertMiniCard">
          <div class="alert-mini-header">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="alert-mini-title">Alert</div>
          </div>
          <div class="alert-mini-content">
            <div class="alert-mini-text" id="alertMiniText">0 Kontaminasi</div>
            <div class="alert-mini-subtext" id="alertMiniSubtext">Terdeteksi hari ini</div>
            <button class="alert-mini-btn" id="alertMiniBtn">Lihat Detail</button>
          </div>
        </div>
      </div>

      <div class="samples-card card">
        <div class="samples-header">
          <div class="samples-title">Sampel Terbaru</div>
          <button class="view-all-btn">
            <span>Lihat Semua</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="samples-list"></div>
      </div>

      <div class="warning-card card" id="warningCard" style="display: none;">
        <div class="warning-header">
          <div class="warning-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="warning-title">Peringatan Aktif</div>
        </div>
        <div class="warning-content">
          <div class="warning-top">
            <div class="warning-details">
              <div class="warning-item" id="warningItem">Loading...</div>
              <div class="warning-desc" id="warningDesc">Loading...</div>
            </div>
            <div class="warning-badge" id="warningBadge">URGENT</div>
          </div>
          <div class="warning-bottom">
            <div class="warning-time">
              <i class="fas fa-clock"></i>
              <span id="warningTime">Loading...</span>
            </div>
            <div class="warning-actions">
              <button class="warning-btn detail">Detail</button>
              <button class="warning-btn process">
                <i class="fas fa-bolt"></i>
                <span>Proses</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav class="bottom-nav">
      <div class="nav-container">
        <a href="home.html" class="nav-btn active" id="home-btn">
          <i class="fas fa-home"></i>
          <span class="nav-label">Home</span>
        </a>
        <a href="control.html" class="nav-btn" id="control-btn">
          <i class="fas fa-sliders-h"></i>
          <span class="nav-label">Kontrol</span>
        </a>
        <a href="analysis.html" class="nav-btn" id="analysis-btn">
          <i class="fas fa-file-image"></i>
          <span class="nav-label">Analisis</span>
        </a>
        <a href="database.html" class="nav-btn" id="database-btn">
          <i class="fas fa-database"></i>
          <span class="nav-label">Database</span>
        </a>
        <a href="profile.html" class="nav-btn" id="profile-btn">
          <i class="fas fa-user"></i>
          <span class="nav-label">Profile</span>
        </a>
      </div>
    </nav>
    <script>
      // Chat bubble click handler
      document.addEventListener("DOMContentLoaded", function () {
        const chatBubble = document.getElementById("chatBubble");
        if (chatBubble) {
          chatBubble.addEventListener("click", function () {
            window.location.href = "chatbot.html";
          });
        }
      });

      // Data for the application
      const trendData = [18, 22, 25, 21, 19, 15, 23];
      const days = ["S", "S", "R", "K", "J", "S", "M"];
      const maxTrend = Math.max(...trendData);

      // Generate trend chart bars
      function generateTrendChart() {
        const trendChart = document.querySelector(".trend-chart");
        trendChart.innerHTML = ""; // Clear existing bars
        trendData.forEach((value, index) => {
          const barContainer = document.createElement("div");
          barContainer.className = "trend-bar-container";

          const valueElement = document.createElement("div");
          valueElement.className = "trend-value";
          valueElement.textContent = value;

          const barElement = document.createElement("div");
          barElement.className = "trend-bar";
          barElement.style.height = `${(value / maxTrend) * 100}%`;

          const dayElement = document.createElement("div");
          dayElement.className = "trend-day";
          dayElement.textContent = days[index];

          barContainer.appendChild(valueElement);
          barContainer.appendChild(barElement);
          barContainer.appendChild(dayElement);

          trendChart.appendChild(barContainer);
        });
      }

      // Generate sample items from Firestore
      async function generateSampleItems() {
        const samplesList = document.querySelector(".samples-list");
        if (!samplesList) return; // Exit if element not found
        
        try {
          const user = firebase.auth().currentUser;
          if (!user) {
            samplesList.innerHTML = '<p style="text-align: center; color: var(--gray-500); font-size: 0.625rem; padding: 2rem;">Silakan login untuk melihat sampel terbaru</p>';
            return;
          }

          // Fetch latest 5 analysis records from Firestore
          const querySnapshot = await firebase.firestore()
            .collection('analysis')
            .where('userId', '==', user.uid)
            .limit(5)
            .get();

          samplesList.innerHTML = ""; // Clear existing items

          if (querySnapshot.empty) {
            samplesList.innerHTML = '<p style="text-align: center; color: var(--gray-500); font-size: 0.625rem; padding: 2rem;">Belum ada data analisis</p>';
            return;
          }

          const sampleData = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const totalCFU = data.results?.totalCFU || 0;
            const resultStatus = data.results?.status?.toLowerCase() || '';
            
            let status = 'safe';
            if (resultStatus === 'bahaya' || totalCFU > 100) {
              status = 'danger';
            } else if (resultStatus === 'warning' || totalCFU > 30) {
              status = 'warning';
            }

            sampleData.push({
              name: data.foodName || 'Tidak ada nama',
              status: status,
              cfu: totalCFU,
              time: data.time || '-'
            });
          });

          // Sort by timestamp (newest first)
          sampleData.sort((a, b) => {
            const timeA = a.time.split(':').map(Number);
            const timeB = b.time.split(':').map(Number);
            return (timeB[0] * 60 + timeB[1]) - (timeA[0] * 60 + timeA[1]);
          });
          
          sampleData.forEach((sample) => {
            const sampleItem = document.createElement("div");
            sampleItem.className = `sample-item ${sample.status}`;

            sampleItem.innerHTML = `
              <div class="sample-info">
                  <div class="sample-icon">
                      <i class="fas ${
                        sample.status === "safe"
                          ? "fa-check-circle"
                          : sample.status === "warning"
                          ? "fa-exclamation-triangle"
                          : "fa-times-circle"
                      }"></i>
                  </div>
                  <div class="sample-details">
                      <div class="sample-name">${sample.name}</div>
                      <div class="sample-cfu">${sample.cfu ? sample.cfu + ' CFU/ml' : 'Aman'}</div>
                  </div>
              </div>
              <div class="sample-meta">
                  <div class="sample-time">${sample.time}</div>
                  <div class="sample-status">${sample.status.toUpperCase()}</div>
              </div>
            `;
            samplesList.appendChild(sampleItem);
          });

          console.log(`Loaded ${sampleData.length} recent samples from Firestore`);
        } catch (error) {
          console.error('Error fetching samples from Firestore:', error);
          samplesList.innerHTML = '<p style="text-align: center; color: var(--red-500); font-size: 0.625rem; padding: 2rem;">Gagal memuat data sampel</p>';
        }
      }

      // Generate warning card from Firestore
      async function generateWarningCard() {
        const warningCard = document.getElementById('warningCard');
        if (!warningCard) return;

        try {
          const user = firebase.auth().currentUser;
          if (!user) {
            warningCard.style.display = 'none';
            return;
          }

          // Fetch latest dangerous analysis from Firestore
          const querySnapshot = await firebase.firestore()
            .collection('analysis')
            .where('userId', '==', user.uid)
            .get();

          let dangerousAnalysis = null;
          let latestDangerousTime = null;

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const totalCFU = data.results?.totalCFU || 0;
            const resultStatus = data.results?.status?.toLowerCase() || '';
            
            // Check if this is a dangerous analysis
            const isDangerous = resultStatus === 'bahaya' || totalCFU > 100;
            
            if (isDangerous) {
              const analysisTime = data.createdAt || data.timestamp;
              if (!latestDangerousTime || (analysisTime && analysisTime.toMillis() > latestDangerousTime.toMillis())) {
                dangerousAnalysis = data;
                latestDangerousTime = analysisTime;
              }
            }
          });

          if (dangerousAnalysis) {
            // Calculate time difference
            const now = new Date();
            const analysisTime = latestDangerousTime ? latestDangerousTime.toDate() : new Date(dangerousAnalysis.time);
            const timeDiff = Math.floor((now - analysisTime) / (1000 * 60)); // minutes ago
            
            let timeText;
            if (timeDiff < 1) {
              timeText = 'Baru saja';
            } else if (timeDiff < 60) {
              timeText = `${timeDiff} menit lalu`;
            } else if (timeDiff < 1440) {
              const hours = Math.floor(timeDiff / 60);
              timeText = `${hours} jam lalu`;
            } else {
              const days = Math.floor(timeDiff / 1440);
              timeText = `${days} hari lalu`;
            }

            // Get bacteria information
            const bacteria = dangerousAnalysis.results?.bacteria || [];
            let bacteriaDesc = '';
            if (bacteria.length > 0) {
              const mainBacteria = bacteria[0];
              bacteriaDesc = `${mainBacteria.name || mainBacteria.scientific || 'Bakteri'} contamination`;
            } else {
              bacteriaDesc = 'Kontaminasi bakteri';
            }

            // Update DOM elements
            document.getElementById('warningItem').textContent = `${dangerousAnalysis.foodName || 'Makanan'} - Analisis`;
            document.getElementById('warningDesc').textContent = `${bacteriaDesc} (${dangerousAnalysis.results?.totalCFU || 0} CFU/ml)`;
            document.getElementById('warningTime').textContent = timeText;
            
            // Set badge based on CFU level
            const cfu = dangerousAnalysis.results?.totalCFU || 0;
            let badgeText = 'URGENT';
            if (cfu > 500) {
              badgeText = 'CRITICAL';
            } else if (cfu > 300) {
              badgeText = 'URGENT';
            } else {
              badgeText = 'WARNING';
            }
            document.getElementById('warningBadge').textContent = badgeText;

            warningCard.style.display = 'block';
            console.log('Warning card displayed with dangerous analysis');
          } else {
            warningCard.style.display = 'none';
            console.log('No dangerous analysis found');
          }

        } catch (error) {
          console.error('Error fetching warning data from Firestore:', error);
          warningCard.style.display = 'none';
        }
      }

      // Update stats from Firestore
      async function updateStatsFromFirestore() {
        try {
          const user = firebase.auth().currentUser;
          if (!user) {
            // Reset stats if user not logged in
            document.getElementById('totalScanValue').textContent = '0';
            document.getElementById('contaminationValue').textContent = '0';
            document.getElementById('sterilValue').textContent = '0';
            document.getElementById('successRateValue').textContent = '0%';
            return;
          }

          // Get today's date range
          const now = new Date();
          const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);

          // Fetch all analysis records from Firestore (client-side filtering)
          const querySnapshot = await firebase.firestore()
            .collection('analysis')
            .where('userId', '==', user.uid)
            .get();

          let totalScan = 0;
          let contamination = 0;
          let steril = 0;

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const analysisTime = data.createdAt || data.timestamp;
            
            // Check if analysis is from today
            if (analysisTime) {
              const analysisDate = analysisTime.toDate ? analysisTime.toDate() : new Date(analysisTime);
              if (analysisDate >= startOfDay && analysisDate < endOfDay) {
                const totalCFU = data.results?.totalCFU || 0;
                const resultStatus = data.results?.status?.toLowerCase() || '';
                
                totalScan++;
                
                // Count contamination (dangerous + warning)
                if (resultStatus === 'bahaya' || totalCFU > 100 || 
                    resultStatus === 'warning' || totalCFU > 30) {
                  contamination++;
                } else {
                  steril++;
                }
              }
            }
          });

          // Calculate success rate (percentage of safe analyses)
          const successRate = totalScan > 0 ? Math.round((steril / totalScan) * 100) : 0;

          // Update DOM elements
          document.getElementById('totalScanValue').textContent = totalScan;
          document.getElementById('contaminationValue').textContent = contamination;
          document.getElementById('sterilValue').textContent = steril;
          document.getElementById('successRateValue').textContent = `${successRate}%`;

          console.log(`Stats updated - Total: ${totalScan}, Contamination: ${contamination}, Steril: ${steril}, Success Rate: ${successRate}%`);

        } catch (error) {
          console.error('Error updating stats from Firestore:', error);
          // Set default values on error
          document.getElementById('totalScanValue').textContent = '0';
          document.getElementById('contaminationValue').textContent = '0';
          document.getElementById('sterilValue').textContent = '0';
          document.getElementById('successRateValue').textContent = '0%';
        }
      }

      // Update breakdown from Firestore
      async function updateBreakdownFromFirestore() {
        try {
          const user = firebase.auth().currentUser;
          if (!user) {
            // Reset breakdown if user not logged in
            document.getElementById('safeValue').textContent = '0';
            document.getElementById('warningValue').textContent = '0';
            document.getElementById('dangerValue').textContent = '0';
            document.getElementById('safePercentage').textContent = '0%';
            document.getElementById('warningPercentage').textContent = '0%';
            document.getElementById('dangerPercentage').textContent = '0%';
            return;
          }

          // Get today's date range
          const now = new Date();
          const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);

          // Fetch all analysis records from Firestore (client-side filtering)
          const querySnapshot = await firebase.firestore()
            .collection('analysis')
            .where('userId', '==', user.uid)
            .get();

          let safe = 0;
          let warning = 0;
          let danger = 0;

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const analysisTime = data.createdAt || data.timestamp;
            
            // Check if analysis is from today
            if (analysisTime) {
              const analysisDate = analysisTime.toDate ? analysisTime.toDate() : new Date(analysisTime);
              if (analysisDate >= startOfDay && analysisDate < endOfDay) {
                const totalCFU = data.results?.totalCFU || 0;
                const resultStatus = data.results?.status?.toLowerCase() || '';
                
                // Categorize based on CFU and status
                if (resultStatus === 'bahaya' || totalCFU > 100) {
                  danger++;
                } else if (resultStatus === 'warning' || totalCFU > 30) {
                  warning++;
                } else {
                  safe++;
                }
              }
            }
          });

          const total = safe + warning + danger;

          // Calculate percentages
          const safePercentage = total > 0 ? ((safe / total) * 100).toFixed(1) : 0;
          const warningPercentage = total > 0 ? ((warning / total) * 100).toFixed(1) : 0;
          const dangerPercentage = total > 0 ? ((danger / total) * 100).toFixed(1) : 0;

          // Update DOM elements
          document.getElementById('safeValue').textContent = safe;
          document.getElementById('warningValue').textContent = warning;
          document.getElementById('dangerValue').textContent = danger;
          document.getElementById('safePercentage').textContent = `${safePercentage}%`;
          document.getElementById('warningPercentage').textContent = `${warningPercentage}%`;
          document.getElementById('dangerPercentage').textContent = `${dangerPercentage}%`;

          console.log(`Breakdown updated - Safe: ${safe} (${safePercentage}%), Warning: ${warning} (${warningPercentage}%), Danger: ${danger} (${dangerPercentage}%)`);

        } catch (error) {
          console.error('Error updating breakdown from Firestore:', error);
          // Set default values on error
          document.getElementById('safeValue').textContent = '0';
          document.getElementById('warningValue').textContent = '0';
          document.getElementById('dangerValue').textContent = '0';
          document.getElementById('safePercentage').textContent = '0%';
          document.getElementById('warningPercentage').textContent = '0%';
          document.getElementById('dangerPercentage').textContent = '0%';
        }
      }

      // Update alert mini card from Firestore
      async function updateAlertMiniCard() {
        try {
          const user = firebase.auth().currentUser;
          if (!user) {
            // Reset alert if user not logged in
            document.getElementById('alertMiniText').textContent = '0 Kontaminasi';
            document.getElementById('alertMiniSubtext').textContent = 'Terdeteksi hari ini';
            return;
          }

          // Get today's date range
          const now = new Date();
          const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);

          // Fetch all analysis records from Firestore (client-side filtering)
          const querySnapshot = await firebase.firestore()
            .collection('analysis')
            .where('userId', '==', user.uid)
            .get();

          let contaminationCount = 0;
          let dangerCount = 0;

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const analysisTime = data.createdAt || data.timestamp;
            
            // Check if analysis is from today
            if (analysisTime) {
              const analysisDate = analysisTime.toDate ? analysisTime.toDate() : new Date(analysisTime);
              if (analysisDate >= startOfDay && analysisDate < endOfDay) {
                const totalCFU = data.results?.totalCFU || 0;
                const resultStatus = data.results?.status?.toLowerCase() || '';
                
                // Count contamination (dangerous + warning)
                if (resultStatus === 'bahaya' || totalCFU > 100 || 
                    resultStatus === 'warning' || totalCFU > 30) {
                  contaminationCount++;
                  
                  // Count dangerous specifically
                  if (resultStatus === 'bahaya' || totalCFU > 100) {
                    dangerCount++;
                  }
                }
              }
            }
          });

          // Update DOM elements
          document.getElementById('alertMiniText').textContent = `${contaminationCount} Kontaminasi`;
          
          // Update subtext based on contamination level
          let subtext = 'Terdeteksi hari ini';
          if (dangerCount > 0) {
            subtext = `${dangerCount} berbahaya hari ini`;
          } else if (contaminationCount > 0) {
            subtext = 'Perhatian diperlukan';
          } else {
            subtext = 'Semua aman hari ini';
          }
          document.getElementById('alertMiniSubtext').textContent = subtext;

          // Update button text and behavior
          const alertBtn = document.getElementById('alertMiniBtn');
          if (contaminationCount > 0) {
            alertBtn.textContent = 'Lihat Detail';
            alertBtn.onclick = () => {
              // Redirect to database page to see details
              window.location.href = 'database.html';
            };
          } else {
            alertBtn.textContent = 'Riwayat';
            alertBtn.onclick = () => {
              // Redirect to database page
              window.location.href = 'database.html';
            };
          }

          console.log(`Alert mini card updated - Contamination: ${contaminationCount}, Danger: ${dangerCount}`);

        } catch (error) {
          console.error('Error updating alert mini card from Firestore:', error);
          // Set default values on error
          document.getElementById('alertMiniText').textContent = '0 Kontaminasi';
          document.getElementById('alertMiniSubtext').textContent = 'Terdeteksi hari ini';
        }
      }

      // Initialize the application
      // Handle logout
      function handleLogout() {
        firebase
          .auth()
          .signOut()
          .then(() => {
            window.location.href = "login.html";
          })
          .catch((error) => {
            console.error("Logout Error:", error);
          });
      }

      // Real-time date and time update
      function updateDateTime() {
        const now = new Date();
        
        // Format date in Indonesian
        const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
        
        const dayName = days[now.getDay()];
        const date = now.getDate();
        const month = months[now.getMonth()];
        const year = now.getFullYear();
        
        const formattedDate = `${dayName}, ${date} ${month} ${year}`;
        
        // Format time
        const time = now.toLocaleTimeString('id-ID', { 
          hour: '2-digit', 
          minute: '2-digit'
        });
        
        // Update DOM elements
        const dateElement = document.getElementById('currentDate');
        const timeElement = document.getElementById('currentTime');
        
        if (dateElement) {
          dateElement.textContent = formattedDate;
        }
        if (timeElement) {
          timeElement.textContent = time;
        }
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        // Update date and time immediately and then every second
        updateDateTime();
        setInterval(updateDateTime, 1000);
        
        // Update stats, breakdown, and alert every 30 seconds for real-time data
        setInterval(updateStatsFromFirestore, 30000);
        setInterval(updateBreakdownFromFirestore, 30000);
        setInterval(updateAlertMiniCard, 30000);
        
        // Check authentication state
        firebase.auth().onAuthStateChanged((user) => {
          if (!user) {
            window.location.href = "login.html";
            return;
          }

          // User is signed in, load the app
          generateTrendChart();
          updateStatsFromFirestore().catch(error => {
            console.error('Error loading stats:', error);
          });
          updateBreakdownFromFirestore().catch(error => {
            console.error('Error loading breakdown:', error);
          });
          updateAlertMiniCard().catch(error => {
            console.error('Error loading alert mini:', error);
          });
          generateSampleItems().catch(error => {
            console.error('Error loading samples:', error);
          });
          generateWarningCard().catch(error => {
            console.error('Error loading warning:', error);
          });

          // Update user info in the UI
          if (user.displayName) {
            const userNameElement = document.querySelector(".user-name");
            if (userNameElement) {
              userNameElement.textContent = user.displayName;
            }
          }

          // Add logout functionality
          const logoutBtn = document.getElementById("logout-btn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", handleLogout);
          }
        });

        // Add click handlers for navigation
        const navButtons = document.querySelectorAll(".nav-btn");
        navButtons.forEach((button) => {
          button.addEventListener("click", function () {
            navButtons.forEach((btn) => btn.classList.remove("active"));
            this.classList.add("active");
          });
        });

        // Add click handlers for various buttons
        document
          .querySelector(".view-all-btn")
          .addEventListener("click", () =>
            alert("Menampilkan semua sampel...")
          );
        // Alert mini button click handler is now set dynamically in updateAlertMiniCard()
        document
          .querySelector(".warning-btn.detail")
          .addEventListener("click", () =>
            alert("Membuka detail peringatan...")
          );
        document
          .querySelector(".warning-btn.process")
          .addEventListener("click", () => alert("Memproses peringatan..."));
        document
          .querySelector(".notification-btn")
          .addEventListener("click", () => alert("Menampilkan notifikasi..."));
      });
    </script>

    <!-- Chatbot Container -->
    <div class="chatbot-container" id="chatbotContainer">
      <div class="chatbot-header">
        <div class="chatbot-title">
          <i class="fas fa-robot"></i>
          <span>BioLens Assistant</span>
        </div>
        <button class="chatbot-close" id="chatbotClose">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="chatbot-messages" id="chatbotMessages">
        <div class="chatbot-message bot">
          <div class="message-content">
            Halo! Saya asisten BioLens. Ada yang bisa saya bantu?
          </div>
          <div class="message-time">Baru saja</div>
        </div>
      </div>
      <div class="chatbot-input">
        <input
          type="text"
          id="chatbotInput"
          placeholder="Ketik pesan Anda..."
        />
        <button id="chatbotSend">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>

    <!-- Chatbot Toggle Button -->
    <a href="chatbot.html" class="chatbot-toggle" id="chatbotToggle">
      <i class="fas fa-comment-dots"></i>
    </a>

    <style>
      /* Chatbot Styles */
      .chatbot-toggle {
        position: fixed;
        bottom: 5.5rem;
        right: 1.5rem;
        width: 3.5rem;
        height: 3.5rem;
        border-radius: 50%;
        text-decoration: none;
        background: linear-gradient(135deg, var(--primary-600), var(--primary-500));
        color: white;
        border: none;
        box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        z-index: 1000;
        transition: all 0.3s ease;
      }

      .chatbot-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 25px rgba(37, 99, 235, 0.4);
      }

      .chatbot-container {
        position: fixed;
        bottom: 6rem;
        right: 1.5rem;
        width: 320px;
        height: 500px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        z-index: 1001;
        transform: translateY(20px);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .chatbot-container.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }

      .chatbot-header {
        background: linear-gradient(135deg, var(--primary-600), var(--primary-500));
        color: white;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chatbot-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        font-size: 1rem;
      }

      .chatbot-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.25rem;
        cursor: pointer;
        padding: 0.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        width: 28px;
        height: 28px;
      }

      .chatbot-close:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .chatbot-messages {
        flex: 1;
        padding: 1rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .chatbot-message {
        max-width: 80%;
        padding: 0.75rem 1rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        line-height: 1.4;
        position: relative;
      }

      .chatbot-message.bot {
        background: #f3f4f6;
        color: #1f2937;
        align-self: flex-start;
        border-bottom-left-radius: 0.25rem;
      }

      .chatbot-message.user {
        background: var(--primary-600);
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 0.25rem;
      }

      .message-time {
        font-size: 0.65rem;
        opacity: 0.7;
        margin-top: 0.25rem;
        text-align: right;
      }

      .chatbot-input {
        display: flex;
        padding: 1rem;
        border-top: 1px solid #e5e7eb;
        background: white;
      }

      .chatbot-input input {
        flex: 1;
        padding: 0.75rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 2rem;
        font-size: 0.875rem;
        outline: none;
        transition: border-color 0.2s;
      }

      .chatbot-input input:focus {
        border-color: var(--primary-600);
      }

      .chatbot-input button {
        margin-left: 0.5rem;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background: var(--primary-600);
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
      }

      .chatbot-input button:hover {
        background: var(--primary-700);
      }
    </style>

    <script>
      // Chatbot redirect functionality
      document.addEventListener("DOMContentLoaded", function () {
        const chatbotToggle = document.getElementById("chatbotToggle");

        // Remove the inline chat container since we're redirecting to chatbot.html
        const chatbotContainer = document.getElementById("chatbotContainer");
        if (chatbotContainer) {
          chatbotContainer.remove();
        }

        // Add click handler to ensure proper navigation
        if (chatbotToggle) {
          chatbotToggle.addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "chatbot.html";
          });
        }
      });
    </script>
  </body>
</html>
